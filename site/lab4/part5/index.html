
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>五、实验步骤 - 计算机组成原理实验（2022春季） | 哈工大（深圳）</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#ffa724">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="计算机组成原理实验（2022春季） | 哈工大（深圳）" class="md-header__button md-logo" aria-label="计算机组成原理实验（2022春季） | 哈工大（深圳）" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 48v416c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h224c26.51 0 48 21.49 48 48zm96 58v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42V88h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zM30 376h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            计算机组成原理实验（2022春季） | 哈工大（深圳）
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              五、实验步骤
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://hitsz-cslab.gitee.io/organ" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    HITSZ-COMP2008-Course
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      实验须知
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../ojguide/" class="md-tabs__link">
      实验提交说明
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="计算机组成原理实验（2022春季） | 哈工大（深圳）" class="md-nav__button md-logo" aria-label="计算机组成原理实验（2022春季） | 哈工大（深圳）" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M416 48v416c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h224c26.51 0 48 21.49 48 48zm96 58v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42V88h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zm0 96v12a6 6 0 0 1-6 6h-18v6a6 6 0 0 1-6 6h-42v-48h42a6 6 0 0 1 6 6v6h18a6 6 0 0 1 6 6zM30 376h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6zm0-96h42v48H30a6 6 0 0 1-6-6v-6H6a6 6 0 0 1-6-6v-12a6 6 0 0 1 6-6h18v-6a6 6 0 0 1 6-6z"/></svg>

    </a>
    计算机组成原理实验（2022春季） | 哈工大（深圳）
  </label>
  
    <div class="md-nav__source">
      
<a href="https://hitsz-cslab.gitee.io/organ" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    HITSZ-COMP2008-Course
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        实验须知
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../ojguide/" class="md-nav__link">
        实验提交说明
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#parta" class="md-nav__link">
    PartA: 熟悉框架
  </a>
  
    <nav class="md-nav" aria-label="PartA: 熟悉框架">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" class="md-nav__link">
    5.1 熟悉数据通路总体结构
  </a>
  
    <nav class="md-nav" aria-label="5.1 熟悉数据通路总体结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#511-logisim" class="md-nav__link">
    5.1.1 选读: Logisim基础入门
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#512-cpu" class="md-nav__link">
    5.1.2 熟悉简易CPU的结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#513" class="md-nav__link">
    5.1.3 控制信号及其含义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#514" class="md-nav__link">
    5.1.4 思考
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" class="md-nav__link">
    5.2 熟悉项目结构
  </a>
  
    <nav class="md-nav" aria-label="5.2 熟悉项目结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#521" class="md-nav__link">
    5.2.1 模块层次结构
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#522" class="md-nav__link">
    5.2.2 查看原理图
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3 模块介绍
  </a>
  
    <nav class="md-nav" aria-label="5.3 模块介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531-datapath" class="md-nav__link">
    5.3.1 DataPath
  </a>
  
    <nav class="md-nav" aria-label="5.3.1 DataPath">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5311-regs" class="md-nav__link">
    5.3.1.1 Regs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5312-mem_wrap" class="md-nav__link">
    5.3.1.2 mem_wrap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5313-alu" class="md-nav__link">
    5.3.1.3 ALU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-b" class="md-nav__link">
    Part B: 实现步骤
  </a>
  
    <nav class="md-nav" aria-label="Part B: 实现步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#54" class="md-nav__link">
    5.4 编写微指令（实验作业）
  </a>
  
    <nav class="md-nav" aria-label="5.4 编写微指令（实验作业）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#541" class="md-nav__link">
    5.4.1 微指令字段的编码及其意义
  </a>
  
    <nav class="md-nav" aria-label="5.4.1 微指令字段的编码及其意义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#5411-condjmp" class="md-nav__link">
    5.4.1.1 condJMP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5412-condselcondjmp1" class="md-nav__link">
    5.4.1.2 condSel（在condJMP为1时考虑）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5413-nextaddrsel" class="md-nav__link">
    5.4.1.3 nextAddrSel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5414-addr" class="md-nav__link">
    5.4.1.4 addr
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#542" class="md-nav__link">
    5.4.2 微指令编写模板
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55" class="md-nav__link">
    5.5 设计控制单元
  </a>
  
    <nav class="md-nav" aria-label="5.5 设计控制单元">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#551" class="md-nav__link">
    5.5.1 使用寄存器阵列实现控存
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#552" class="md-nav__link">
    5.5.2 实现其他逻辑
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="_1">五、实验步骤</h1>
<h2 id="parta">PartA: 熟悉框架</h2>
<h3 id="51">5.1 熟悉数据通路总体结构</h3>
<p>我们为大家准备的实验大礼包中，包括以下内容：</p>
<div class="highlight"><pre><span></span><code>logisim.exe     --- 电路仿真软件
DataPath.circ        --- 可仿真的CPU数据通路原理图
微指令表.xlsx     --- 微指令编写辅助表格
Lab4_Microcode  --- Vivado项目文件夹
</code></pre></div>
<h4 id="511-logisim">5.1.1 选读: Logisim基础入门</h4>
<p>如果你对Logisim的使用已经熟悉，可以跳过。</p>
<p>参考链接：华中科技大学《计算机组成原理》Logisim使用指导：<a href="https://www.bilibili.com/video/BV1LE411q77o?p=2">https://www.bilibili.com/video/BV1LE411q77o?p=2</a></p>
<h4 id="512-cpu">5.1.2 熟悉简易CPU的结构</h4>
<p>其中，我们强烈推荐在进行实验之前，先对整个CPU的架构有一个完整的认知，所以我们使用简单的电路仿真软件<code>logisim.exe</code>，使用logisim打开<code>DataPath.circ</code>文件，你会看到我们设计的CPU的完整结构：</p>
<p><img alt="image-20200422234540018" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200422234540018.png" /></p>
<p>其中，红色框内标注的，就是我们所要实现的控制单元需要输出的控制信号。</p>
<p>我们的CPU中有7个寄存器，分别为：</p>
<blockquote>
<p>PC：指令指针</p>
<p>IR：指令寄存器</p>
<p>MAR：内存地址寄存器</p>
<p>MDR：内存数据寄存器</p>
<p>ACC：累加寄存器</p>
<p>SP：栈顶寄存器</p>
<p>R：通用寄存器</p>
</blockquote>
<p>请务必熟悉：</p>
<ul>
<li>哪些寄存器连接到了总线？</li>
<li>哪些寄存器没有连接到总线？</li>
<li>哪些寄存器有多个数据来源？</li>
<li>ALU的端口是如何连接的？</li>
</ul>
<p>其中，IR寄存器的输出连接到控制单元，<code>MAR</code>寄存器的输出连接到内存的地址端口，<del>（暗号：地）</del> 其余所有寄存器都连接到内部总线，较为特殊的是<code>MDR</code>寄存器，不仅连接到内部总线，还连接到了主存的数据端口（用于写数据）。</p>
<p>在所有的寄存器中，<code>IR</code>, <code>MAR</code>, <code>SP</code>,<code>R</code>的值只能来源于总线输入，其余寄存器规定如下：</p>
<ul>
<li><code>MDR</code>寄存器的值，既可以来源于总线输入，又可以来源于主存数据输出，由<code>MDRSel</code>控制</li>
<li><code>PC</code>寄存器的值，既可以来源于总线输入，又可以来源于自身+1的值，由<code>PCSel</code>控制</li>
<li><code>ACC</code>的值，既可以来源于总线输入，又可以来源于ALU的输出，ALU的功能由<code>ALUSel</code>控制</li>
</ul>
<p>需要注意的是，ALU的输入值分别为ACC的值和总线的值。</p>
<h4 id="513">5.1.3 控制信号及其含义</h4>
<table>
<thead>
<tr>
<th>控制信号</th>
<th>含义</th>
<th>宽度</th>
</tr>
</thead>
<tbody>
<tr>
<td>*_i（例如PC_i, MDR_i等）</td>
<td>寄存器写使能信号（高电平有效）</td>
<td>1</td>
</tr>
<tr>
<td>*_o（例如PC_o, MDR_o等）</td>
<td>寄存器输出到总线使能（三态门使能，高电平有效）</td>
<td>1</td>
</tr>
<tr>
<td>PC_Sel</td>
<td>PC输入源（0：总线，1：PC+1）</td>
<td>1</td>
</tr>
<tr>
<td>MDR_Sel</td>
<td>MDR输入源（0：总线，1：主存）</td>
<td>1</td>
</tr>
<tr>
<td>ACC_Sel</td>
<td>ACC输入源（0：总线，1：ALU）</td>
<td>1</td>
</tr>
<tr>
<td>ALU_Sel</td>
<td>ALU功能选择（0：与，1：加）</td>
<td>1</td>
</tr>
<tr>
<td>MemRead，MemWrite</td>
<td>主存读写信号（高电平有效）</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>对于主存读时序，请参照后面的章节5.3.1.2：mem_wrap</strong></p>
<h4 id="514">5.1.4 思考</h4>
<p>尝试改变各种控制信号，控制时钟脉冲，完成：</p>
<ul>
<li>寄存器-&gt;寄存器传输操作</li>
<li>算术运算操作</li>
<li>寄存器-&gt;主存的双向数据交互</li>
<li>发挥你的想象力完成各种操作</li>
</ul>
<p><strong>建议不要跳过这个步骤，直到你真正熟悉了各种时序关系。</strong></p>
<p>完成以下思考题，有助于你进行接下来的实验：</p>
<blockquote>
<ol>
<li>完成一次取指令操作（IR的值出现在IR_to_CU端口上）需要几个时钟周期？每一个周期内，各个控制信号是怎么样的（只需列出非0的控制信号）？数据的流动方向是什么？</li>
<li>完成一次寄存器之间的数据移动，需要几个时钟周期？控制信号是什么？</li>
<li>完成一次主存的写操作，需要几个时钟周期？每一个周期内，各个控制信号是怎么样的（只需列出非0的控制信号）？数据的流动方向是什么？</li>
<li>完成一次算术运算操作，并将结果写回到存储器，大概的流程是什么样？</li>
</ol>
</blockquote>
<h3 id="52">5.2 熟悉项目结构</h3>
<h4 id="521">5.2.1 模块层次结构</h4>
<div class="highlight"><pre><span></span><code>| ---- top(top.v): 顶层模块
   |---- Control_Unit(Control_Unit.v): 控制逻辑（需要完成）
   |---- DataPath(DataPath.v): 数据通路，包括寄存器、总线、ALU和主存
      |---- Regs(Regs.v): CPU内的通用寄存器
      |---- mem_wrap(mem_wrap.v): 主存模型
      |---- ALU(ALU.v): 算术逻辑单元
</code></pre></div>
<p><img alt="image-20200502195706910" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200502195706910.png" /></p>
<h4 id="522">5.2.2 查看原理图</h4>
<p><img alt="image-20200430220841660" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200430220841660.png" /></p>
<p>点击左侧的<code>RTL ANALYSIS</code>，点击<code>Schematic</code>，可以看到顶层模块的连接逻辑。</p>
<p><img alt="image-20200430220517375" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200430220517375.png" /></p>
<p>可以展开<code>dp</code>模块，查看内部连线逻辑。</p>
<p><strong>模块的IO和内部的互联方式，除了在Verilog中，我们将寄存器模块封装了以下，其他的与我们给出的logisim源文件是一致的，如果不熟悉，可以打开之前的原理图文件熟悉一下。</strong></p>
<p><img alt="image-20200430220700519" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200430220700519.png" /></p>
<h3 id="53">5.3 模块介绍</h3>
<p>本实验采用数据通路和控制逻辑分离的方式，故<code>top</code>模块中，包含以下两个子模块。</p>
<h4 id="531-datapath">5.3.1 DataPath</h4>
<p><img alt="image-20200501103658099" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200501103658099.png" /></p>
<p>DataPath模块，与我们给出的<code>datapath.circ</code>原理图文件一致。主要职责是根据传入的控制信号，建立相应的数据通路，完成寄存器之间、寄存器和存储器之间、寄存器和ALU之间的数据传输。其模块IO定义如下：</p>
<table>
<thead>
<tr>
<th>输入信号</th>
<th>描述</th>
<th>来源</th>
</tr>
</thead>
<tbody>
<tr>
<td>*_i,*_o, *_Sel, MemRead, MemWrite</td>
<td>用以控制数据传输的控制信号</td>
<td>控制单元CU</td>
</tr>
<tr>
<td>clk, reset</td>
<td>时钟和复位</td>
<td>外部</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>输出信号</th>
<th>描述</th>
<th>去向</th>
</tr>
</thead>
<tbody>
<tr>
<td>IR2CU</td>
<td>取回的指令</td>
<td>控制单元CU</td>
</tr>
<tr>
<td>ZF</td>
<td>零标志位，ACC=0时为1</td>
<td>控制单元CU</td>
</tr>
</tbody>
</table>
<p>DataPath内部还有其他的子模块。</p>
<h5 id="5311-regs">5.3.1.1 Regs</h5>
<table>
<thead>
<tr>
<th>输入信号</th>
<th>描述</th>
<th>来源</th>
</tr>
</thead>
<tbody>
<tr>
<td>*_i,*_o, *_Sel</td>
<td>用以寄存器之间数据传输的控制信号</td>
<td>上层模块DataPath</td>
</tr>
<tr>
<td>clk, reset</td>
<td>时钟和复位</td>
<td>外部</td>
</tr>
<tr>
<td>ALU_result</td>
<td>ALU的运算结果</td>
<td>ALU</td>
</tr>
<tr>
<td>Mem_rdata</td>
<td>主存读出的数据</td>
<td>mem_wrap</td>
</tr>
<tr>
<td>Bus_din</td>
<td>寄存器总线数据输入</td>
<td>上层数据总线wire</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>输出信号</th>
<th>描述</th>
<th>去向</th>
</tr>
</thead>
<tbody>
<tr>
<td>*_to_Bus</td>
<td>寄存器输出到总线的数据（三态）</td>
<td>上层数据总线wire</td>
</tr>
<tr>
<td>ACC_to_ALU, MAR_to_MEM, MDR_to_MEM</td>
<td>寄存器输出到功能部件的数据</td>
<td>其他功能部件（ALU，MEM）</td>
</tr>
<tr>
<td>IR2CU</td>
<td>输出给外部的控制器</td>
<td>上层模块的IR2CU</td>
</tr>
</tbody>
</table>
<h5 id="5312-mem_wrap">5.3.1.2 mem_wrap</h5>
<p><strong>注意：<code>MemRead</code>和<code>MemWrite</code>实际上是控制信号寄存器，位于主存模块<code>mem_wrap</code>的内部。所以，在微操作中指明<code>MemRead=1</code>或是<code>MemWrite=1</code>时，实际上，在下一个时钟周期，<code>MemRead</code>或<code>MemWrite</code>才会真正变成1！</strong></p>
<p><img alt="image-20200503225136580" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1release.assets/image-20200503225136580.png" /></p>
<p><del>（暗号：虎）</del> 注意主存的读写时序，例如，在第1个周期时，控制器的输出信号<code>MemRead</code>为1，那么在第2个周期，主存内部的<code>MemRead_reg</code>才会变为1，在当前周期，主存读出有效的数据。</p>
<p>请务必理解<code>MemRead</code>和<code>MemWrite</code>是输出给 <strong>控制寄存器</strong> 的信号。</p>
<h5 id="5313-alu">5.3.1.3 ALU</h5>
<p>ALU仅有2个功能，由ALUSel决定。</p>
<ul>
<li>ALUSel=0，则ALU执行按位与运算</li>
<li>ALUSel=1，则ALU执行无符号加法运算</li>
</ul>
<p><strong>阅读完毕，请完成平台上的“Lab4: 微程序控制的CPU设计（概念测试）”</strong></p>
<h2 id="part-b">Part B: 实现步骤</h2>
<h3 id="54">5.4 编写微指令（实验作业）</h3>
<h4 id="541">5.4.1 微指令字段的编码及其意义</h4>
<p>控制字段前面已经介绍过，此处不再赘述。</p>
<h5 id="5411-condjmp">5.4.1.1 condJMP</h5>
<ul>
<li>0：不考虑标志位</li>
<li>1：考虑标志位</li>
</ul>
<h5 id="5412-condselcondjmp1">5.4.1.2 condSel（在condJMP为1时考虑）</h5>
<ul>
<li>0：ZF</li>
<li>1：~ZF</li>
</ul>
<h5 id="5413-nextaddrsel">5.4.1.3 nextAddrSel</h5>
<ul>
<li>00：uPC+1</li>
<li>01：直接下址</li>
<li>10：操作码译码的入口地址</li>
</ul>
<h5 id="5414-addr">5.4.1.4 addr</h5>
<ul>
<li>显式指明的下地址字段</li>
</ul>
<h4 id="542">5.4.2 微指令编写模板</h4>
<p>打开实验大礼包中的<code>微指令表.xlsx</code>文件。</p>
<p>其中，粉红色的部分是你需要填写的控制信号，每一条微指令填写一行，绿色部分是微指令的下址字段，包括下址选择、标志选择和绝对地址字段，最后一列<code>microcode</code>是偷懒神器，你不必瞎眼的对着屏幕一个个打数字，只需表格填写完，就会按照从左至右、高位到低位的顺序自动拼接生成微指令。</p>
<p>为了保护大家的视力，表格中为1的控制信号会自动变成绿色突出显示。</p>
<p>我们已经编写好了部分微指令，请你按照相应的方法完成剩余微程序的编写，注意充分参照表中已有的信息！</p>
<blockquote>
<p>需要完成：</p>
<ul>
<li>取指微程序（可以在Logisim中先操作）</li>
<li>MOVE / ADD / AND</li>
<li>JUMPZ / JUMPNZ（可以参照给出的JUMP）</li>
<li>所有微指令的下址字段 <code>nextAddrSel</code>和<code>addr</code></li>
</ul>
</blockquote>
<p><img alt="image-20200423233644698" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200423233644698.png" /></p>
<p>由于一条指令可能对应多条微代码，擅长使用”合并单元格“工具，如下图：</p>
<p><img alt="image-20200423234339607" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200423234339607.png" /></p>
<p>编写完毕后，请将最后一列直接选中，将自动生成的微指令的内容复制到<code>microcode.txt</code>文本文件中。</p>
<p><img alt="image-20200503001302736" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200503001302736.png" /></p>
<h3 id="55">5.5 设计控制单元</h3>
<h4 id="551">5.5.1 使用寄存器阵列实现控存</h4>
<p>首先方框中的这一部分：</p>
<p><img alt="image-20200503000634739" src="../%E5%AE%9E%E9%AA%8C%E5%9B%9B%EF%BC%9A%E5%BE%AE%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6CPU%E8%AE%BE%E8%AE%A1.assets/image-20200503000634739.png" /></p>
<p>为实现方便，本次实验的所有存储器均采用仿真模型的方式构建，以避免过多综合IP核耗费时间。</p>
<p>同时，将自己编写的微代码复制到记事本中，并保存在项目<code>Lab4_Microcode.sim\sim_1\behav\xsim</code>文件夹，在<code>initial</code>语句中，初始化控存。</p>
<p>控存有256行，每行32位，<strong>其中高2位用作保留</strong>！</p>
<p><strong>此处一定注意：由于本次实验对存储器采用仿真模型（不要求上板），所以使用到了<code>initial</code>语句，在实际设计中，<code>intial</code>大多无法综合成电路！</strong></p>
<div class="highlight"><pre><span></span><code>reg [31 : 0] urom[255 : 0];
initial begin
    $readmemb(&quot;microcode.txt&quot;, urom);
end
</code></pre></div>
<p>上述语句中，<code>$readmemb</code>的意思是，使用<code>microcode.dat</code>文件中的二进制来初始化<code>urom</code>寄存器阵列。再次强调，由于此次我们对所有存储器建立的都是 <strong>仿真模型</strong> ，仅可用于仿真验证，所以请不要在以后需要FPGA验证的实验中使用，在实际上板时，我们会使用<code>distributed ram</code>的IP核来完成这个设计。</p>
<h4 id="552">5.5.2 实现其他逻辑</h4>
<p>请根据”实验原理“中的叙述，按照相应的框图，设计微指令控制单元。</p>
<p>要求：</p>
<ul>
<li>微指令的编码方式为我们在”微指令表“中提供的编码方式，其中，<code>PC_i</code>信号为<code>MSB</code>，<code>addr</code>的最低位为<code>LSB</code>。</li>
<li>微指令控制器的设计，遵照上面的编码方式进行。</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 - 2022 哈尔滨工业大学（深圳）
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>